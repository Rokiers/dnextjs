# ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

## ğŸ¯ å·²å®Œæˆçš„å·¥ä½œ

æˆ‘ä¸ºä½ çš„é¡¹ç›®é…ç½®äº† **Zod** ç¯å¢ƒå˜é‡éªŒè¯ç³»ç»Ÿï¼Œç¡®ä¿åº”ç”¨å¯åŠ¨å‰æ‰€æœ‰ç¯å¢ƒå˜é‡éƒ½æ­£ç¡®é…ç½®ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. ç±»å‹å®‰å…¨
```typescript
// âœ… æœ‰å®Œæ•´çš„ç±»å‹æç¤ºå’Œæ£€æŸ¥
import { env } from '@/config/env';
const apiUrl = env.NEXT_PUBLIC_API_URL;  // string ç±»å‹

// âŒ é¿å…è¿™æ ·ä½¿ç”¨
const apiUrl = process.env.NEXT_PUBLIC_API_URL;  // string | undefined
```

### 2. æ—©æœŸé”™è¯¯æ£€æµ‹
å¦‚æœç¯å¢ƒå˜é‡é…ç½®é”™è¯¯ï¼Œåº”ç”¨å¯åŠ¨æ—¶ä¼šç«‹å³æ˜¾ç¤ºæ¸…æ™°çš„é”™è¯¯ï¼š
```
ğŸš¨ ç¯å¢ƒå˜é‡éªŒè¯å¤±è´¥:
  âŒ JWT_SECRET: String must contain at least 32 character(s)
  âŒ DATABASE_URL: Invalid url
```

### 3. é˜²æ­¢é…ç½®é”™è¯¯
- ç¼ºå¤±çš„ç¯å¢ƒå˜é‡ä¼šè¢«ç«‹å³å‘ç°
- æ ¼å¼é”™è¯¯çš„å€¼ä¼šè¢«æ‹’ç»
- ä¸ä¼šå› ä¸ºé…ç½®é—®é¢˜å¯¼è‡´éš¾ä»¥è¿½è¸ªçš„ bug

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
# Backend
cd backend
npm install

# Frontend
cd dnextjs
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

#### Backend
```bash
cd backend
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œç‰¹åˆ«æ³¨æ„ï¼š
# - JWT_SECRET å¿…é¡»è‡³å°‘ 32 ä¸ªå­—ç¬¦
# - DATABASE_URL å¿…é¡»æ˜¯æœ‰æ•ˆçš„ PostgreSQL è¿æ¥å­—ç¬¦ä¸²
```

ç”Ÿæˆå®‰å…¨çš„ JWT Secretï¼š
```bash
npm run generate:jwt-secret
```

#### Frontend
```bash
cd dnextjs
cp env.example .env.local
# ç¼–è¾‘ .env.local æ–‡ä»¶
```

### 3. å¯åŠ¨åº”ç”¨
```bash
# Backend
cd backend
npm run start:dev

# Frontend
cd dnextjs
npm run dev
```

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

### Backend (NestJS)
- `backend/src/config/env.validation.ts` - ç¯å¢ƒå˜é‡éªŒè¯é€»è¾‘
- `backend/src/config/README.md` - ä½¿ç”¨æ–‡æ¡£
- `backend/scripts/generate-jwt-secret.js` - JWT å¯†é’¥ç”Ÿæˆå·¥å…·
- `backend/.env.example` - å·²æ›´æ–°ï¼ŒåŒ…å«è¯¦ç»†è¯´æ˜

### Frontend (Next.js)
- `dnextjs/src/config/env.ts` - ç¯å¢ƒå˜é‡éªŒè¯é€»è¾‘
- `dnextjs/src/config/README.md` - ä½¿ç”¨æ–‡æ¡£
- `dnextjs/src/lib/api.ts` - API å®¢æˆ·ç«¯ç¤ºä¾‹
- `dnextjs/env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿

### æ–‡æ¡£
- `ENV_SETUP.md` - è¯¦ç»†é…ç½®æŒ‡å—
- `QUICK_START.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- `ENV_VALIDATION_SUMMARY.md` - æ–¹æ¡ˆæ€»ç»“
- `SETUP_CHECKLIST.md` - é…ç½®æ£€æŸ¥æ¸…å•

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### Backend ä¸­ä½¿ç”¨
```typescript
import { ConfigService } from '@nestjs/config';
import { EnvConfig } from './config/env.validation';

@Injectable()
export class AuthService {
  constructor(private config: ConfigService<EnvConfig>) {}

  generateToken() {
    const secret = this.config.get('JWT_SECRET', { infer: true });
    // ä½¿ç”¨ secret...
  }
}
```

### Frontend ä¸­ä½¿ç”¨
```typescript
import { env } from '@/config/env';

// åœ¨ç»„ä»¶ä¸­
export default function HomePage() {
  const handleFetch = async () => {
    const response = await fetch(`${env.NEXT_PUBLIC_API_URL}/api/products`);
    // ...
  };
}

// æˆ–ä½¿ç”¨å°è£…çš„ API å®¢æˆ·ç«¯
import { apiRequest } from '@/lib/api';
const products = await apiRequest<Product[]>('/products');
```

## âš ï¸ é‡è¦æç¤º

### Backend å¿…éœ€çš„ç¯å¢ƒå˜é‡
```env
NODE_ENV=development
PORT=4000
DATABASE_URL=postgresql://postgres:password@postgres:5432/ecommerce
JWT_SECRET=è‡³å°‘32ä¸ªå­—ç¬¦çš„å®‰å…¨å¯†é’¥
JWT_EXPIRES_IN=7d
CORS_ORIGIN=http://localhost:3000
```

### Frontend å¿…éœ€çš„ç¯å¢ƒå˜é‡
```env
NODE_ENV=development
API_URL=http://backend:4000              # æœåŠ¡ç«¯ä½¿ç”¨
NEXT_PUBLIC_API_URL=http://localhost:4000  # å®¢æˆ·ç«¯ä½¿ç”¨
NEXT_PUBLIC_APP_NAME=E-commerce App
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

1. **æ°¸è¿œä¸è¦æäº¤ .env æ–‡ä»¶åˆ° Git**
2. **JWT_SECRET è‡³å°‘ 32 ä¸ªå­—ç¬¦**
3. **ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®**
4. **æ•æ„Ÿä¿¡æ¯ä¸è¦ä½¿ç”¨ NEXT_PUBLIC_ å‰ç¼€**

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **å¿«é€Ÿå¼€å§‹**: æŸ¥çœ‹ `QUICK_START.md`
- **è¯¦ç»†é…ç½®**: æŸ¥çœ‹ `ENV_SETUP.md`
- **æ–¹æ¡ˆæ€»ç»“**: æŸ¥çœ‹ `ENV_VALIDATION_SUMMARY.md`
- **é…ç½®æ¸…å•**: æŸ¥çœ‹ `SETUP_CHECKLIST.md`
- **Backend ä½¿ç”¨**: æŸ¥çœ‹ `backend/src/config/README.md`
- **Frontend ä½¿ç”¨**: æŸ¥çœ‹ `dnextjs/src/config/README.md`

## ğŸ§ª æµ‹è¯•éªŒè¯

æµ‹è¯•ç¯å¢ƒå˜é‡éªŒè¯æ˜¯å¦å·¥ä½œï¼š

```bash
# Backend - JWT_SECRET å¤ªçŸ­ä¼šå¤±è´¥
cd backend
JWT_SECRET=short npm run start:dev

# Frontend - æ— æ•ˆçš„ URL ä¼šå¤±è´¥
cd dnextjs
NEXT_PUBLIC_API_URL=invalid npm run dev
```

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆé€‰æ‹© Zodï¼Ÿ
A: Zod æä¾›å®Œæ•´çš„ TypeScript æ”¯æŒã€æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ã€é›¶è¿è¡Œæ—¶å¼€é”€ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡ï¼Ÿ
A: 
1. åœ¨ `env.validation.ts` (Backend) æˆ– `env.ts` (Frontend) ä¸­æ·»åŠ éªŒè¯è§„åˆ™
2. æ›´æ–° `.env.example` æ–‡ä»¶
3. æ›´æ–°ä½ çš„ `.env` æ–‡ä»¶

### Q: ç¯å¢ƒå˜é‡éªŒè¯å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œå®ƒä¼šå‡†ç¡®æŒ‡å‡ºå“ªä¸ªå˜é‡æœ‰é—®é¢˜ã€‚å‚è€ƒ `.env.example` æ–‡ä»¶ç¡®è®¤æ ¼å¼ã€‚

## âœ… ä¸‹ä¸€æ­¥

1. âœ… å®‰è£…ä¾èµ– (`npm install`)
2. âœ… é…ç½®ç¯å¢ƒå˜é‡ (å¤åˆ¶å¹¶ç¼–è¾‘ `.env` æ–‡ä»¶)
3. âœ… å¯åŠ¨åº”ç”¨
4. âœ… å¼€å§‹å¼€å‘ï¼

ç°åœ¨ä½ çš„åº”ç”¨ä¸ä¼šå†å› ä¸ºç¯å¢ƒå˜é‡é…ç½®é”™è¯¯è€Œå‡ºç°éš¾ä»¥è¿½è¸ªçš„ bug äº†ï¼ğŸ‰
